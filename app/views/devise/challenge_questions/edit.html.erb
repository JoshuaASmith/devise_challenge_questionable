<h2>Change your challenge questions</h2>

<%= form_for(resource, :as => resource_name, :url => challenge_question_path(resource_name), :html => { :method => :put }) do |f| %>
  <%= devise_error_messages! %>
  <%= f.hidden_field :reset_challenge_questions_token %>
  
  <%= f.fields_for :"#{resource_name}_challenge_questions", resource.send("#{resource_name}_challenge_questions") do |cq| %>
    <% if cq.object.new_record? %>
      <p>
        <%= cq.select :challenge_question, Devise.challenge_questions, :prompt => '-- select --' %>
        <br />
        <%= cq.text_field :challenge_answer %>
      </p>
    <% end %>
  <% end %>

  <p><%= f.submit "Change my challenge questions" %></p>
<% end %>

<%= link_to "Resend me reset challenge question instructions", new_challenge_question_path(resource_name) %>

<script type="text/javascript" language="javascript">
  $("select").each(function () {
    var $this = $(this);
    var prevVal = $this.data("prev");
    var otherSelects = $("select").not(this);
    otherSelects.find("option[value=" + $(this).val() + "]").attr('disabled', true);
    if (prevVal) {
        otherSelects.find("option[value=" + prevVal + "]").attr('disabled', false);
    }  
    $this.data("prev", $this.val());
  });
  
  $("select").change(function () {
    var $this = $(this);
    var prevVal = $this.data("prev");
    var otherSelects = $("select").not(this);
    otherSelects.find("option[value=" + $(this).val() + "]").attr('disabled', true);
    if (prevVal) {
        otherSelects.find("option[value=" + prevVal + "]").attr('disabled', false);
    }  
    $this.data("prev", $this.val());
  });
</script>